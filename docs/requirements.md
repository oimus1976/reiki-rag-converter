---
title: requirements(要件定義書)
version: v1.0
doc_type: reference
project: reiki-rag-converter
created: 2025-12-02
updated: 2025-12-06
author: Sumio Nishioka + ChatGPT
tags:
  - testing
  - reference
  - oss
  - reiki-rag-converter
---

# 要件定義書  
reiki-rag-converter（例規HTML → AI/RAG 向けテキスト変換ツール）

---

## 1. 背景

地方自治体の条例（例規集）は HTML 形式で公開されているが：

- DOM構造が不統一（HTML揺れ）
- 附則の扱いが自治体間で異なる
- 表は読み込みが難しい（colspan/rowspan）
- RAG向けの前処理が未整備

これらの課題により、AI検索やQ&Aシステムで  
「第3条の表を教えて」「附則の施行日を教えて」  
といった精度の高い回答が困難であった。

---

## 2. ユースケース（必須）

### 2.1 職員向け

- AI に条例の特定条文を尋ねる  
- 条・項・号の説明を生成  
- 附則の構造化・施行日抽出

### 2.2 研究・開発向け

- 条例データをRAGに投入  
- 例規集の自動解析  
- 表形式データの構造化

---

## 3. 機能要件

### 3.1 validate（構造検証）

- E001/E003/E004/E007 の検出
- S1/S2/S3 の構造イベント記録
- 詳細ログ（条例単位JSON）
- 総合ログ（summary_report / class_statistics / structure_summary）

### 3.2 convert（変換）

- 条・項・号を Markdown/TXT 化  
- 附則ヘッダ（s-head）の解析  
- 表（table）のMarkdown化  
- YAML frontmatter の付加  
- HTML → TXT の一括変換

---

## 4. 非機能要件

- **速度**：条例1000件を数分以内  
- **精度**：条番号抽出100%（v2.6で達成済）  
- **拡張性**：colspan/rowspan対応など将来の改善に耐える設計  
- **公開性**：著作権を侵害しない構造データのみをGitHub公開

---

## 5. 制約

- HTML本文そのものは著作物 → GitHub公開不可  
- DVD内のHTML構造に依存（自治体差に注意）  
- Python 3.10 以上

---

## 6. 今後の拡張要件（v3以降）

- colspan/rowspan  
- 附則モデル v0.6（改正文抽出）  
- 条・項・号の YAML 構造化  
- 別記様式の抽出  
- RAG向けチャンク分割と座標情報付加（v4）

---

## 7. RAG / Qommons.AI 連携要件

### 7.1 対応RAG

- 本ツールが公式に対応するRAG基盤は Qommons.AI とする。
- 生成される TXT / CSV は、Qommons.AI へのアップロードを前提に設計する。
- その他のRAGへの適用は「ベストエフォート」とし、要件には含めない。

### 7.2 ナレッジ構成要件

- 単位：条例1本につき、原則として
  - `条例ID.txt`（Markdown互換のテキスト）  
  - 必要に応じて `条例ID_別表X.csv`
  を生成する。
- Qommons.AI 上でナレッジを選択する単位が「ファイル」であるため、
  ディレクトリ構造やタグに依存した要件は設けない。
- 本番運用では「共有＋所属部署」範囲にアップロードされた全ファイルが
  検索対象となることを前提とする。

### 7.3 TXT / CSV コンテンツ設計要件

- TXTファイル：
  - 条・項・号・附則・表タイトルを Markdown の見出しとし、
    見出しだけを読んでも条の意味が推測できる表現にする。
  - 別表に関する条文には、必ず  
    「（具体の手数料は『◯◯条例_別表.csv』を参照）」等の文言を入れる。
- CSVファイル：
  - 1行目は必ずヘッダー行とし、`手続き名`, `手数料` 等の意味のある列名を付与する。
  - 先頭に1〜数行の説明行を置き、
    - このCSVがどの条例に対応するか
    - 条例本文（TXT）との対応関係
    を明示する。
- TXT と CSV の語彙・ファイル名・別表名はできる限り揃え、
  Qommons.AI の類似度検索で両方が同時に上位に出やすくする。

### 7.4 RAG 検索精度要件（更新）

- 既存要件を次のように具体化する。  
  - 条例QAに関する代表質問セット（10〜20問程度）を用意する。
  - Qommons.AI（国内リージョンモデル＋Web検索OFF）に対し、
    - 正答：条例の内容に沿った回答が得られ、引用元ファイルが妥当であるもの
    - 部分正答：概ね正しいが、条番号や一部数値などに軽微な誤りがあるもの
    - 誤答：条文と食い違う内容、または完全に的外れな回答
    に3分類して評価する。
  - 「正答＋部分正答」が全体の80％以上となることを合格基準とする。
