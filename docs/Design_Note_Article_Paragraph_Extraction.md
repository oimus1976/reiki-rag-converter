# 条・項抽出アルゴリズム設計メモ

**— 質問具体化フェーズ向け（外部共有用）—**

## 1. 目的（Why）

本メモは、条例HTMLから
**「第○条」および「第○条第○項」**を
**ユーザーが質問具体化時に選択可能な候補として正確に列挙する**ための
抽出設計思想を定義する。

本設計は、

* 解釈
* 評価
* 質問生成
  とは**完全に分離**される。

---

## 2. 抽出対象（MUST）

抽出してよいのは、**HTML構造上「定義位置」と判断できるもののみ**。

### 2.1 条（Article）

* 「第○条」が **条見出しとして定義されているHTMLブロック**
* 見出し階層・DOM位置により
  **条の開始点であることが明確に判断できるもの**

### 2.2 項（Paragraph）

* 条の直下に存在し、
  **構造的に項として配置されているブロック**
* 第1項〜第n項として **条に従属していることがDOM構造で保証されるもの**

---

## 3. 抽出しないもの（MUST NOT）

以下は **いかなる場合も抽出対象に含めてはならない**。

* 本文中の参照表現

  * 「第○条において」
  * 「前条」
  * 「同項」 等
* 文脈・意味解釈を必要とする表現
* 本文テキスト中に偶然現れる条番号表記
* 号・ただし書き（※初期段階では対象外）
* 解釈補助のために生成された仮想的な条・項

---

## 4. 典型的な失敗例（過去に破綻した設計）

以下の設計は **必ず破綻するため禁止**とする。

* 正規表現で「第○条」「第○項」を全文検索する
* 本文テキストを走査して番号表現を拾う
* 「意味的に条っぽい」などの推測で判断する
* LLM に「条を抽出させる」前提の設計

これらはすべて、
**本文中の参照表現を誤って抽出する**原因となる。

---

## 5. 正しい判断軸（Design Principle）

### 5.1 判断基準は「意味」ではない

* 条・項かどうかの判断は
  **文言・意味・自然言語理解に依存してはならない**

### 5.2 判断基準は「HTML構造位置」

* 抽出可否は
  **DOM構造上の役割（定義位置）だけで決定する**
* テキスト内容は **一切信頼しない**

---

## 6. 責務境界の明確化（重要）

本抽出処理の責務は以下に限定される。

* ✅ ユーザーに提示する
  **「選択可能な条・項候補」の列挙**
* ❌ 条文の解釈
* ❌ どの条を使うべきかの判断
* ❌ 質問文の生成
* ❌ 評価・正誤判定

抽出は **UIの選択肢生成のための前処理**であり、
意味処理・評価処理とは完全に分離される。

---

## 7. 本設計が守ること

* 本文参照の誤抽出を構造的に防止する
* 条数・項数の誤認識を防ぐ
* 将来、号・ただし書きを拡張対象として
  **安全に段階的拡張できる余地を残す**
* 同じ失敗ルートを二度と通らない

---

以上。
